#!/bin/bash
# Copyright CÃ©dric Picard 2016 -- License WTFPL

HELP="\
Automated discovery toolset

Usage: ${0##*/}

Change the configuration directly in the script
"

##############################################################################
# Configuration
##############################################################################

need_root=true

output_dir=trixec

target_domains=()

target_ranges=()

# Choose here what to launch
todo() {
    launch traceroute 8.8.8.8 &
    launch traceroute yahoo.com &
    launch traceroute gateway &
    launch traceroute $target_domains &
    launch nmap_discover  $target_ranges &
    launch nmap_targetted $target_ranges &
    launch theharverster $target_domains &
    launch dnsenum $target_domains &
}

##############################################################################
# Tool definitions
##############################################################################

launch_traceroute() {
    if [ $# -eq 0 ] ; then
        return 1
    fi

    sudo tcptraceroute "$1"
}

launch_nmap_discover() {
    nmap -sP "$1"
}

launch_nmap_targetted() {
    general_options="-sS --top-ports 2048 -T4 -vvv --reason"
    sudo nmap -AO $general_options "$@"
    sudo nmap -sU $general_options "$@"
}

launch_theharvester() {
    theharvester -b all -d "$1" -v -n -t -h
}

launch_dnsenum() {
    dnsenum --nocolor "$1"
}

##############################################################################
# Internals
##############################################################################

STATUS_FILE="$(mktemp -u)"
export REPORT=""

# do tool args...
launch() {
    local type="$1"

    if [ "$#" -ge 2 ] ; then
        shift
    fi

    while [ $# -ne 0 ] ; do
        local target="$type\e[0m$(if [ "$type" != "$1" ]; then
                                            echo ": $1";
                                         fi)"

        echo -e "\e[33mLaunch \e[0m$target"

        local outfile_base="${type}__$1"

        timestamp="\n## $(date) ##\n"
        echo -e "$timestamp" >>"${outfile_base}.out"
        echo -e "$timestamp" >>"${outfile_base}.err"
        "launch_${type}" "$1" >>"${outfile_base}.out" 2>>"${outfile_base}.err"

        if [ $? -ne 0 ] ; then
            touch "$STATUS_FILE"
            echo -en "\e[31m"
        else
            echo -en "\e[32m"
        fi
        echo -e "Finish \e[0m$1"

        shift
    done
}

launch_() {
    echo "The command you have asked for doesn't exist."
    echo "Please add a function named launch_<command_name>"
    echo "in the 'Tool definition' section of trixec"
    false
}

###############################################################################
# Process management
##############################################################################

if [ $# -ne 0 ] ; then
    echo -e "$HELP"
    exit 1
fi

# Cache sudo password for applications requiring it
if [ "$(whoami)" != root ] ; then
    sudo true
fi

mkdir -p "$output_dir"
cd "$output_dir"

todo

wait

echo -e "$REPORT"

if [ -e "$STATUS_FILE" ] ; then
    rm "$STATUS_FILE"
    exit "1"
fi

printf "%s" "[0m[0m __________________ [0m
[0m< SUCCESS!!!!!!!!![0m >[0m
[0m ------------------ [0m[00m
                  [0m\[0m                                [00m
                   [0m\[0m                               [00m
                    [0m\[0m                              [00m
                     [0m\[0m                             [00m
                      [0m\[0m      [38;5;97mâ–„â–„[39m                    [00m
        [38;5;97mâ–„[48;5;97;38;5;104mâ–„â–„â–„â–„â–„â–„â–„[48;5;229;38;5;229mâ–ˆ[38;5;104mâ–„[48;5;104mâ–ˆâ–ˆ[48;5;97mâ–„[49;38;5;97mâ–„â–„â–„â–„[39m [38;5;97mâ–„[48;5;97;38;5;104mâ–„[48;5;104mâ–ˆâ–ˆ[48;5;97;38;5;97mâ–ˆ[49;39m                    [00m
       [48;5;97;38;5;104mâ–„[48;5;229;38;5;229mâ–ˆ[48;5;104;38;5;104mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;153;38;5;153mâ–ˆ[48;5;104;38;5;104mâ–ˆ[48;5;97mâ–„[48;5;104mâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;110;38;5;255mâ–„[38;5;153mâ–„[49;38;5;110mâ–„[39m                  [00m
      [38;5;97mâ–„[48;5;104;38;5;104mâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;153mâ–„[38;5;153mâ–ˆ[38;5;104mâ–„[48;5;104mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;153mâ–„â–„[38;5;153mâ–ˆ[38;5;104mâ–„[48;5;104mâ–ˆâ–ˆâ–ˆ[38;5;97mâ–„[48;5;97;38;5;74mâ–„[48;5;255;38;5;153mâ–„â–„[48;5;153;38;5;255mâ–„[48;5;110;38;5;153mâ–„[49mâ–„[39m                [00m
      [48;5;97;38;5;97mâ–ˆ[48;5;104;38;5;104mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;97mâ–„[38;5;104mâ–ˆâ–ˆ[38;5;229mâ–„[38;5;104mâ–ˆâ–ˆ[38;5;229mâ–„[48;5;229mâ–ˆ[48;5;104mâ–„[38;5;104mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;97mâ–„[48;5;97;38;5;74mâ–„[48;5;74mâ–ˆâ–ˆ[48;5;67;38;5;16mâ–„[48;5;153mâ–„[38;5;153mâ–ˆâ–ˆ[48;5;255;38;5;255mâ–ˆ[49;39m                [00m
       [48;5;153;38;5;153mâ–ˆ[38;5;104mâ–„â–„[48;5;104mâ–ˆ[48;5;97;38;5;97mâ–ˆ[49;39m [38;5;97mâ–€[38;5;104mâ–€[38;5;229mâ–€[48;5;104;38;5;104mâ–ˆâ–ˆ[38;5;153mâ–„[48;5;229;38;5;104mâ–„[48;5;104mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;97mâ–„[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;67mâ–„[48;5;16;38;5;67mâ–„[48;5;74mâ–„[48;5;16;38;5;74mâ–„[48;5;255mâ–„â–„[48;5;110;38;5;110mâ–ˆ[49;39m  [38;5;110mâ–„[39m            [00m
       [48;5;104;38;5;97mâ–„[38;5;104mâ–ˆâ–ˆâ–ˆ[48;5;97;38;5;97mâ–ˆ[49;39m     [48;5;97;38;5;97mâ–ˆ[48;5;104;38;5;104mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;97mâ–„[48;5;97;38;5;74mâ–„[48;5;16mâ–„â–„â–„â–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;110;38;5;153mâ–„[49;38;5;110mâ–„â–„[48;5;255;38;5;255mâ–ˆ[49;39m  [38;5;60mâ–„â–„â–„[39m       [00m
        [38;5;97mâ–€[48;5;104mâ–„â–„â–„[49;38;5;104mâ–„[38;5;97mâ–„[39m    [48;5;97;38;5;97mâ–ˆ[48;5;104;38;5;104mâ–ˆâ–ˆâ–ˆ[38;5;97mâ–„[48;5;97;38;5;74mâ–„[48;5;74mâ–ˆ[48;5;16;38;5;16mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;67;38;5;218mâ–„[49;38;5;74mâ–€â–€[48;5;153;38;5;153mâ–ˆâ–ˆâ–ˆ[38;5;110mâ–„[49;38;5;60mâ–„[48;5;60;38;5;74mâ–„â–„[48;5;74mâ–ˆâ–ˆ[48;5;60mâ–„[49;38;5;60mâ–„[39m     [00m
            [38;5;97mâ–€[39m    [48;5;97;38;5;67mâ–„[48;5;104mâ–„[48;5;67;38;5;111mâ–„â–„[48;5;97;38;5;67mâ–„[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;67;38;5;67mâ–ˆ[49mâ–€[39m [38;5;110mâ–€â–€â–€[39m [48;5;60;38;5;74mâ–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;60mâ–„[48;5;60mâ–ˆ[49;39m     [00m
                [48;5;67;38;5;67mâ–ˆ[48;5;111;38;5;111mâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;74;38;5;74mâ–ˆ[48;5;67mâ–„[38;5;67mâ–ˆ[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49;38;5;67mâ–€â–€[39m      [48;5;60;38;5;60mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49;38;5;60mâ–€[39m      [00m
                [48;5;97;38;5;97mâ–ˆ[48;5;67mâ–„[48;5;111;38;5;67mâ–„[38;5;74mâ–„â–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;67mâ–„[38;5;97mâ–„â–„â–„[38;5;74mâ–ˆ[48;5;67mâ–„[48;5;97;38;5;97mâ–ˆ[38;5;104mâ–„[49;38;5;97mâ–„[39m [48;5;60;38;5;60mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;60mâ–„[49mâ–€[39m       [00m
                    [38;5;67mâ–€[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;67mâ–„[48;5;104;38;5;67mâ–„[38;5;104mâ–ˆ[48;5;74;38;5;110mâ–„[48;5;110;38;5;231mâ–„[38;5;255mâ–„[48;5;104;38;5;110mâ–„[48;5;97;38;5;97mâ–ˆ[48;5;60;38;5;74mâ–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;60mâ–„[49mâ–€[39m         [00m
                [38;5;97mâ–„â–„[48;5;97mâ–ˆ[38;5;104mâ–„[48;5;104mâ–ˆ[48;5;153;38;5;97mâ–„[48;5;104mâ–„[48;5;67mâ–„[38;5;67mâ–ˆ[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;97;38;5;67mâ–„[48;5;110;38;5;74mâ–„â–„[48;5;74mâ–ˆ[48;5;67;38;5;67mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆ[38;5;60mâ–„[49;39m            [00m
          [38;5;97mâ–„â–„[48;5;97;38;5;104mâ–„â–„â–„â–„[48;5;104mâ–ˆ[48;5;153;38;5;97mâ–„â–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;67;38;5;67mâ–ˆ[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆ[48;5;67mâ–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;60mâ–„[48;5;60;38;5;97mâ–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49mâ–„â–„â–„[39m    [00m
      [38;5;97mâ–„â–„â–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;67mâ–„[48;5;67;38;5;74mâ–„â–„[48;5;74;38;5;67mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;60;38;5;97mâ–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49mâ–„â–„[39m[00m
    [38;5;97mâ–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;110mâ–„â–„â–„[38;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;67mâ–„[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;97;38;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49mâ–€â–€[39m[00m
  [38;5;97mâ–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;153mâ–„[48;5;110;38;5;255mâ–„[48;5;153mâ–„[48;5;255mâ–ˆ[48;5;153mâ–„[48;5;110mâ–„â–„[48;5;97mâ–„â–„[38;5;97mâ–ˆ[38;5;67mâ–„[38;5;74mâ–„[48;5;67mâ–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;67mâ–„[48;5;97;38;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49mâ–€â–€[39m    [00m
     [38;5;97mâ–€â–€[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;255;38;5;255mâ–ˆ[38;5;153mâ–„[48;5;153mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;255mâ–„â–„[48;5;67;38;5;67mâ–ˆ[38;5;74mâ–„[48;5;74mâ–ˆ[48;5;153mâ–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;67;38;5;67mâ–ˆ[38;5;97mâ–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49;39m       [00m
         [38;5;97mâ–€â–€â–€[48;5;255;38;5;255mâ–ˆ[48;5;153;38;5;153mâ–ˆâ–ˆâ–ˆ[48;5;255;38;5;255mâ–ˆ[38;5;153mâ–„â–„[38;5;110mâ–„[48;5;153mâ–„[48;5;74;38;5;74mâ–ˆ[48;5;153mâ–„[38;5;231mâ–„[48;5;231mâ–ˆ[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;67mâ–„[48;5;67mâ–ˆ[38;5;97mâ–„[48;5;97mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ[49mâ–€[39m        [00m
            [48;5;255;38;5;255mâ–ˆ[48;5;153;38;5;153mâ–ˆâ–ˆâ–ˆ[38;5;255mâ–„[38;5;153mâ–ˆ[48;5;110;38;5;110mâ–ˆ[49;39m  [48;5;74;38;5;74mâ–ˆ[48;5;153mâ–„â–„[48;5;67;38;5;67mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;67;38;5;67mâ–ˆ[48;5;74;38;5;74mâ–ˆ[48;5;67;38;5;60mâ–„[49;39m                    [00m
            [48;5;255;38;5;255mâ–ˆ[48;5;153;38;5;153mâ–ˆâ–ˆâ–ˆ[48;5;255;38;5;255mâ–ˆ[48;5;153mâ–„[48;5;110;38;5;153mâ–„[49;38;5;110mâ–„[39m [48;5;74;38;5;74mâ–ˆ[48;5;153mâ–„[48;5;74mâ–ˆâ–ˆâ–ˆâ–ˆ[38;5;67mâ–„[48;5;67mâ–ˆâ–ˆ[48;5;60;38;5;74mâ–„[49;38;5;60mâ–„[39m                   [00m
            [48;5;255;38;5;255mâ–ˆâ–ˆâ–ˆ[48;5;153;38;5;153mâ–ˆâ–ˆ[48;5;255;38;5;255mâ–ˆ[48;5;153;38;5;153mâ–ˆâ–ˆ[48;5;110;38;5;110mâ–ˆ[49;38;5;67mâ–€[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;67;38;5;67mâ–ˆ[49;38;5;60mâ–€[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;60;38;5;60mâ–ˆ[49;39m                  [00m
            [48;5;110;38;5;110mâ–ˆ[48;5;255;38;5;255mâ–ˆâ–ˆ[48;5;153;38;5;153mâ–ˆâ–ˆ[48;5;255;38;5;255mâ–ˆâ–ˆ[48;5;153;38;5;153mâ–ˆ[48;5;110;38;5;110mâ–ˆ[49;39m [48;5;67;38;5;67mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;67mâ–„[49;38;5;67mâ–„[38;5;60mâ–€[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆ[48;5;60mâ–„[38;5;60mâ–ˆ[49;39m                 [00m
          [48;5;110;38;5;110mâ–ˆ[49mâ–„â–„[48;5;110;38;5;255mâ–„[48;5;153;38;5;153mâ–ˆâ–ˆ[48;5;110;38;5;110mâ–ˆ[48;5;153;38;5;153mâ–ˆâ–ˆâ–ˆ[48;5;110;38;5;110mâ–ˆ[49;39m [38;5;67mâ–€[48;5;74mâ–„[38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;67;38;5;67mâ–ˆ[49;39m [48;5;60;38;5;60mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;60mâ–„[49;38;5;60mâ–„[39m                [00m
          [48;5;110;38;5;110mâ–ˆ[48;5;255;38;5;255mâ–ˆ[38;5;153mâ–„[48;5;153mâ–ˆâ–ˆ[38;5;110mâ–„[38;5;153mâ–ˆâ–ˆ[38;5;110mâ–„â–„[49mâ–€[39m  [48;5;67;38;5;67mâ–ˆ[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆ[48;5;67mâ–„[49;38;5;67mâ–„[38;5;60mâ–€[48;5;74;38;5;74mâ–ˆâ–ˆâ–ˆâ–ˆ[48;5;60;38;5;60mâ–ˆ[49;39m                [00m
           [38;5;110mâ–€â–€[38;5;153mâ–€[38;5;110mâ–€[38;5;153mâ–€[38;5;110mâ–€â–€[39m     [38;5;67mâ–€[48;5;74mâ–„â–„â–„â–„[48;5;67mâ–ˆ[49;39m [38;5;60mâ–€â–€â–€â–€â–€[39m                [00m
"
exit 0
